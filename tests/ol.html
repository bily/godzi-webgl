<html>
<head>
<title>ReadyMap WebGL</title>

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<script type="text/javascript" src="http://www.openlayers.org/api/OpenLayers.js"></script>
<script type="text/javascript" src="../js/jquery/jquery-1.4.2.js"></script>
<script type="text/javascript" src="../build/readymap-debug-0.0.1.js"></script>

<!--JQuery UI-->
<script type="text/javascript" src="../js/jquery/jquery-ui-1.8.2.custom.min.js"></script>

<link href="../css/ui-lightness/jquery.ui.all.css" rel="stylesheet" type="text/css"></link>
<link href="demo.css" rel="Stylesheet" type="text/css"></link>
<link href="../css/readymap.css" rel="Stylesheet" type="text/css"></link>

<style type="text/css">
   
    #layer-control
    {
    	position: absolute;
    	left: 10px;
    	top: 300px;
    	z-index: 1000;
    }
       
    
    #example-help
    {
    	position: absolute;
    	left: 10px;
    	top: 400px;
    	width: 300px;
    	border: 2px solid white;
    	z-index: 1000;
    }
    
    #Help
    {
    	z-index: 1000 !important;
    	float: none;
    	right: 100px;
    	top: 100px;
    }
    
    
</style>

<script type="text/javascript">

    var layer;
    var olMap = null;

    var is3D = false;

    function initialize(globe) {

        //Destroy the existing map
        if (olMap !== null) {
            olMap.destroy();
        }
            
        // create the OpenLayers map model:
        layer = new OpenLayers.Layer.WMS(
          "OpenLayers Layer",
          "http://readymap.org/readymap/tiles",
          { layers: "22", format: "image/jpeg" },
          { isBaseLayer: true, tileSize: new OpenLayers.Size(256, 256) }
        );

          $("#layer_name").html(layer.name);

        //If we're using a globe, add the controls to the main div instead of the map viewport.
        //This should work with OpenLayers map as well but the controls don't seem to respond if they aren't added to the map viewport
        var controlDiv = null;
        if (globe) {
            controlDiv = document.getElementById("map");
        }

        //Add OpenLayers controls, they work in 3D as well!
        olMap = new OpenLayers.Map("map", { controls: [] });
        olMap.addControl(new OpenLayers.Control.Navigation({ div: controlDiv }));
        olMap.addControl(new OpenLayers.Control.PanZoom({ div: controlDiv }));

        //Here is where we setup the map.  If you want a 3D map you need to call setupGlobe() on your OpenLayers map immediately after creation.
        //When you are finished adding layers to your map, call finishGlobe() on your map.  When ReadyMap supports adding layers dynamically
        //finishGlobe won't be necessary
        if (globe) olMap.setupGlobe();
        olMap.addLayer(layer);
        if (globe) olMap.finishGlobe();

        //Zoom to the max extent
        olMap.zoomToMaxExtent();

        //Setup a slider to control the layer opacity
        $("#opacity_slider").slider({
            range: "min",
            value: 100,
            min: 1,
            max: 100,
            slide: function (event, ui) {
                layer.setOpacity(ui.value / 100);
            }
        });

        //Setup a checkbox to toggle the layer on and off
        $("#enabled_checkbox").click(function () {
            var enabled = $(this).attr("checked");
            layer.setVisibility(enabled);
        });

        $("#enabled_checkbox").attr("checked", "checked");
    }

    $(document).ready(function () {

        // create a view tied to a page element:
        var size = ReadyMap.getWindowSize();
        var headerHeight = jQuery('#header').height();        
        size.h -= headerHeight;
        $("#map").width(size.w);
        $("#map").height(size.h);



        initialize(is3D);

        $("#toggleGlobeButton").click(function () {
            is3D = !is3D;
            if (is3D) {
                $("#toggleGlobeButton").text("Switch to 2D");
            } else {
                $("#toggleGlobeButton").text("Switch to 3D");
            }
            initialize(is3D);
        });
    });




</script>
</head>

<body>

  <div id="header">
    <a href="http://pelicanmapping.com" border="0"><img id="logo" align="right" height="50" src="http://pelicanmapping.com/wp-content/uploads/2011/02/pelican-logo-262x93-light.png" /></a>
    <p>
        ReadyMap / WebGL :: 
        <a href="index.html">demos</a> ::
        <a href="http://godzi.org">wiki</a> :: 
        <a href="http://github.com/gwaldron/godzi-webgl">github</a> ::
        <a href="http://twitter.com/#!/pelicanmapping">twitter</a>
    </p>
  </div>

  <div id="map" style="position: relative">    
  </div>  

  <div id="layer-control" class="ui-widget ui-widget-content">  
        
        <div class="ui-widget-header">Layers</div>
        <div class="'ui-widget-content ui-state-default">
            <input id="enabled_checkbox" type="checkbox" checked="checked" />        
            <span id="layer_name">Layer</span>
            <div id="opacity_slider" style="width: 200px; height: 5px;"></div>
        </div>
  </div>

  <div id="example-help">
    This example demonstrates the new OpenLayers integration.
    It allows you to use ReadyMap to view your existing OpenLayers webpages as a 3D globe with just a few lines of code!<br />
    <button id="toggleGlobeButton">Switch to 3D</button>
  </div>

  <div id="Help">
    <ul>
      <li>drag to pan</li>
      <li>wheel to zoom</li>
      <li>shift-drag to rotate</li>
      <li><a href="#" onclick="olMap.zoomToMaxExtent();">reset view</a></li>            
    </ul>
  </div>


</body>

</html>
